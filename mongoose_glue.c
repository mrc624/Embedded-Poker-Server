// SPDX-FileCopyrightText: 2024 Cesanta Software Limited
// SPDX-License-Identifier: GPL-2.0-only or commercial
// Generated by Mongoose Wizard, https://mongoose.ws/wizard/

// Include your device-specific headers, and edit functions below
// #include "hal.h"

#include "mongoose_glue.h"
#include "mc_time.h"

void glue_init(void) {
  MG_DEBUG(("Custom init done"));
}

// Authenticate user/password. Return access level for the authenticated user:
//   0 - authentication error
//   1,2,3... - authentication success. Higher levels are more privileged than lower
int glue_authenticate(const char *user, const char *pass) {
  int level = 0; // Authentication failure
  if (strcmp(user, "admin") == 0 && strcmp(pass, "admin") == 0) {
    level = 7;  // Administrator
  } else if (strcmp(user, "user") == 0 && strcmp(pass, "user") == 0) {
    level = 3;  // Ordinary dude
  }
  return level;
}


static struct time s_time = {"utc", "local", "up"};
struct time *glue_get_time(void) {
  sprintf(s_time.utc, "%s", get_utc_string());
  sprintf(s_time.local, "%s", get_local_time_string());
  sprintf(s_time.up, "%s", get_uptime_string());
  return &s_time;  // Sync with your device
}
void glue_set_time(struct time *update) {
  s_time = *update; // Sync with your device
}